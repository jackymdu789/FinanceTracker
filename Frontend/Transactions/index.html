<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finance Tracker</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- <link rel="stylesheet" href="styles.css" /> -->
  </head>
  <style>
    .alert {
        position: fixed;
        top: 0;
        right: 0;
        margin: 20px;
        padding: 15px;
        border-radius: 5px;
        z-index: 1000;
        /* Ensure the alert is above other content */
        width: auto;
        /* Adjust width to fit the content */
        max-width: calc(100% - 40px);
        /* Prevent overflow */
      }

      .alert-primary {
        background-color: #cce5ff;
        color: #004085;
      }

      .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
      }

      .close {
        position: absolute;
        top: 10px;
        right: 15px;
        cursor: pointer;
      }
      canvas{
        height: 300px !important;
        width: 300px !important;
        margin: auto;
      }
  </style>
  <body>
    <!-- Navbar -->
    <div id="nav"></div>

    <!-- Main Content -->
    <div class="container" style="margin: 0px; margin-top: 20px; padding: 0px 40px;">
      <!-- Dashboard Section -->
      <section id="dashboard" class="mb-5">
        <h2>Dashboard</h2>
        <div class="row">
          <div class="col-md-6" style="height: 188px;">
            <div class="card mb-4">
              <div class="card-body text-center">
                <h4 class="card-title" style="font-weight: bolder;">Current Balance</h4>
                <p class="card-text">
                  <div id="current-balance" style="height: 48px !important;">
                    <div id="loading-spinner" class="d-flex justify-content-center align-items-center" style="height: 100px;">
                      <div class="spinner-border" role="status">
                        <!-- <span class="sr-only">Loading...</span> -->
                      </div>
                  </div>
                </div>
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6" style="height: 188px;">
            <div class="card mb-4">
              <div class="card-body text-center">
                <h4 class="card-title" style="font-weight: bolder;">Transaction Summary</h4>
                <p class="card-text">
                  <div id="tran-sum">
                    <div id="loading-spinner" class="d-flex justify-content-center align-items-center" style="height: 100px;">
                      <div class="spinner-border" role="status">
                        <!-- <span class="sr-only">Loading...</span> -->
                      </div>
                    </div>
                  </div>
                </p>
              </div>
            </div>
          </div>
        </div>
        </div>
        <div class="row" style="padding: 0px 40px;">
          <div class="row">
            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-body">
                  <h5 class="card-title">Income Overview</h5>
                  <p class="card-text">
                    This chart provides a visual summary of your income categories.
                  </p>
                  <canvas id="transactionsChart-income" width="300" height="300"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-body">
                  <h5 class="card-title">Expense Overview</h5>
                  <p class="card-text">
                    This chart visualizes the distribution of your expenses across different categories.
                  </p>
                  <canvas id="transactionsChart-expense" width="300" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>          
        </div>
      </section>

      

      <!-- Budget Section -->
      <section  class="mb-5" style="padding: 0px 40px; ">
        <h2>Budget</h2>
        <button class="btn btn-primary mb-4" id="toggleBudgetButton">Show Budget</button>
        <div class="row" id="budget" style="display: none;">
          <div class="col-md-6">
            <div class="card mb-4">
              <div class="card-body">
                <h5 class="card-title">Set Budget</h5>
                <form id="budgetForm">
                  <div class="mb-3">
                    <label for="category" class="form-label">Category</label>
                    <select class="form-select" id="category" required>
                      <option value="">Select a Category</option>
                      <option value="Groceries">Groceries</option>
                      <option value="Rent">Rent</option>
                      <option value="Utilities">Utilities</option>
                      <option value="Entertainment">Entertainment</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label for="amount" class="form-label">Amount</label>
                    <input type="number" class="form-control" id="amount" required />
                  </div>
                  <div class="mb-3">
                    <label for="frequency" class="form-label">Frequency</label>
                    <select class="form-select" id="frequency" required>
                      <option value="monthly">Monthly</option>
                      <option value="weekly">Weekly</option>
                    </select>
                  </div>
                  <button type="submit" class="btn btn-primary">Set Budget</button>
                </form>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card mb-4">
              <div class="card-body">
                <h5 class="card-title">Budget vs. Spending</h5>
                <div id="budget-chart">
                  <img src="https://via.placeholder.com/600x300?text=Budget+Chart" class="img-fluid" alt="Budget Chart" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Transactions Section -->
      <section id="transactions" class="mb-5" style="padding: 0px 40px;">
        <h2>Transactions</h2>
        <div id="loading-logo">
          <div id="loading-spinner" class="d-flex justify-content-center align-items-center" style="height: 100px;">
            <div class="spinner-border" role="status">
              <!-- <span class="sr-only">Loading...</span> -->
            </div>
          </div>
        </div>
        <div id="bodyOfTransactionTable" style="display: none;">
        <div class="sidebar" style="display: flex; justify-content: end">
          <div class="btn-group" role="group" aria-label="Transaction Filters">
            <button
              type="button"
              class="btn btn-outline-primary"
              onclick="filterTransactions('all')"
            >
              Display All
            </button>
            <button
              type="button"
              class="btn btn-outline-primary"
              onclick="filterTransactions('expense')"
            >
              Display Expenses
            </button>
            <button
              type="button"
              class="btn btn-outline-primary"
              onclick="filterTransactions('income')"
            >
              Display Income
            </button>
          </div>
        </div>
        <!-- Bootstrap Modal for Image View -->
        <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="imageModalLabel">View Image</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                      <img id="modalImage" src="" class="img-fluid" alt="Large view" />
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
              </div>
          </div>
        </div>

        <table class="table table-striped">
          <thead>
            <tr>
              <th>Date</th>
              <th>Categorize</th>
              <th>Amount</th>
              <th>Type</th>
              <th>Image</th>
            </tr>
          </thead>
          <tbody id="transactionBody">
            <!-- <tr>
                        <td>2024-07-30</td>
                        <td>Salary</td>
                        <td>$3,500.00</td>
                        <td>Credit</td>
                    </tr>
                    <tr>
                        <td>2024-07-28</td>
                        <td>Groceries</td>
                        <td>$150.00</td>
                        <td>Debit</td>
                    </tr>
                    <tr>
                        <td>2024-07-25</td>
                        <td>Rent</td>
                        <td>$1,200.00</td>
                        <td>Debit</td>
                    </tr> -->
          </tbody>
        </table>
        <button class="m-2bt btn btn-secondary">
          <a href="transactionForm.html" class="text-light nav-link"
            >Add New Transaction</a
          >
        </button>
      </div>
      </section>
      
    </div>
    <script type="module" src="proctedRoute.js"></script>
    <script type="module" src="index.js"></script>
    <script>
      function showAlert(message, alertClass) {
        const alertBox = document.createElement("div");
        alertBox.className = `alert ${alertClass}`;
        alertBox.role = "alert";
        alertBox.id = "alertBox";
        alertBox.innerHTML = `
            ${message} 
            <span class="close" onClick="closeAlert()">&times;</span>
            `;

        document.body.appendChild(alertBox);
        setTimeout(() => {
          closeAlert();
        }, 5000);
      }
      function closeAlert() {
        if (alertBox) {
          alertBox.remove();
        }
      }
      const handleClose = () => {
        sessionStorage.clear();
        window.location.reload();
      };
      function filterTransactions(type) {
        const rows = document.querySelectorAll("#transactionBody tr");
        rows.forEach((row) => {
          if (type === "all") {
            row.style.display = "";
          } else if (row.classList.contains(type)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }
      function openImageModal(imageUrl) {
        const modalImage = document.getElementById('modalImage');
        modalImage.src = imageUrl;
      }

      document.getElementById('toggleBudgetButton').addEventListener('click', function() {
        const budgetSection = document.getElementById('budget');
        if (budgetSection.style.display === 'none') {
          budgetSection.style.display = 'flex';
          this.textContent = 'Hide Budget'; // Change button text
        } else {
          budgetSection.style.display = 'none';
          this.textContent = 'Show Budget'; // Change button text
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="nav.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </body>
</html>
